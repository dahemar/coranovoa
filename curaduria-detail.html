<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cora Novoa - Curaduría - <span id="detail-title">Detalle</span></title>
    
    <!-- Preload fonts -->
    <link rel="preload" href="junicode.webfont/junicode_regular.woff" as="font" type="font/woff" crossorigin="anonymous">
    <link rel="preload" href="junicode.webfont/junicode_bold.woff" as="font" type="font/woff" crossorigin="anonymous">
    <link rel="preload" href="fonts/demo-atbserif-it.otf" as="font" type="font/opentype" crossorigin="anonymous">
    
    <!-- Add accent.css -->
    <link rel="stylesheet" href="accent.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="navigation.css">
    <style>
        /* Font Definitions */
        @font-face {
            font-family: 'Junicode';
            src: url('junicode.webfont/junicode_regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Junicode';
            src: url('junicode.webfont/junicode_bold.woff') format('woff');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'ATB Serif';
            src: url('fonts/demo-atbserif-it.otf') format('opentype');
            font-weight: normal;
            font-style: italic;
            font-display: swap;
        }
        
        body {
            font-family: 'Junicode', sans-serif;
            margin: 0;
            background-color: white;
            color: black;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Junicode', sans-serif;
            font-weight: bold;
        }

        .overlay-content {
            position: relative;
            z-index: 10;
            padding: 40px 0 40px 160px;
            max-width: 1600px;
            margin: 0 auto;
            transition: transform 0.5s ease-out;
            width: 100%;
        }

        .detail-container {
            position: relative;
            margin-top: 135px;
            min-height: 500px;
            max-width: 1200px;
        }

        .detail-content {
            margin-top: 120px;
            display: flex;
            gap: 40px;
        }

        .detail-image {
            width: 400px;
            height: 300px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .detail-text {
            flex: 1;
            font-size: 15px;
            line-height: 1.6;
            color: #333;
        }

        .detail-title {
            font-size: 18px;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .detail-title .atb-title {
            font-family: 'ATB Serif', serif;
            font-weight: normal;
            font-style: italic;
        }

        /* Hide back button on desktop */
        .back-button {
            display: none;
        }



        /* Mobile responsive styles */
        @media (max-width: 768px) {
            body {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }
            
            .overlay-content {
                padding: 20px;
                position: fixed;
                width: 100%;
                height: 100%;
                overflow-y: auto;
                background-color: white;
                z-index: 1000;
            }

            /* Hide header on mobile */
            .overlay-header {
                display: none;
            }

            .detail-container {
                margin-top: 0;
                padding: 0;
            }

            .detail-content {
                margin-top: 0;
                flex-direction: column;
                gap: 30px;
            }

            .detail-image {
                width: 100%;
                height: auto;
                object-fit: contain;
                max-height: 45vh;
                background-color: #f0f0f0;
                margin-bottom: 10px;
            }

            .detail-title {
                font-size: 16px;
                margin-bottom: 25px;
                line-height: 1.4;
            }

            .detail-text {
                color: #a0a0a0;
                font-size: 15px;
                line-height: 1.6;
                margin-top: 10px;
            }

            .back-button {
                display: inline-block;
                margin-top: 45px;
                margin-bottom: -5px;
                padding-left: 20px;
                color: black;
                text-decoration: none;
                font-size: 16px;
                font-weight: normal;
            }
        }

        @media (max-width: 480px) {
            .detail-text {
                font-size: 14px;
            }
            
            .detail-title {
                font-size: 15px;
                margin-bottom: 20px;
            }
            
            .back-button {
                font-size: 15px;
                margin-top: 45px;
                margin-bottom: -5px;
                padding-left: 20px;
            }
            
            .detail-content {
                gap: 25px;
            }
        }
    </style>
</head>

<body>
    <div class="page-container">
        <!-- Back button for mobile -->
        <a href="curaduria.html" class="back-button" onclick="goBack(); return false;">←</a>
        
        <!-- Language switcher -->
        <div class="language-switcher">
            <a href="#" onclick="changeLanguage('gal'); return false;" data-lang="gal">gal</a> /
            <a href="#" onclick="changeLanguage('esp'); return false;" data-lang="esp">esp</a> /
            <a href="#" onclick="changeLanguage('en'); return false;" data-lang="en">en</a>
        </div>
        
        <div class="overlay-content">
            <header class="overlay-header">
                <h1 class="hover-light-grey"><a href="index.html" class="no-underline-link">Cora Novoa</a></h1>
                <nav>
                    <a href="obra.html" class="no-underline-link">obra</a>
                    <a href="bio.html" class="no-underline-link">bio</a>
                    <a href="aldan.html" class="no-underline-link">aldán</a>
                    <a href="curaduria.html" class="no-underline-link active">curaduría</a>
                    <a href="contacto.html" class="no-underline-link">contacto</a>
                </nav>
            </header>

            <div class="detail-container">
                <div class="detail-content">
                    <h2 id="detail-title" class="detail-title"></h2>
                    <img id="detail-image" class="detail-image" src="" alt="">
                    <div class="detail-text">
                        <div id="detail-description"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');
        const currentLang = urlParams.get('lang') || 'gal';

        // Load project data from Google Sheets
                async function loadProjectData() {
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/1GC8bqmQeQHD0H1QnIGAQbOPtBg19_4dkspwZEUjgi1k/values/Curaduria?key=AIzaSyBHQgbSv588A3qr-Kzeo6YrZ9TbVNlrSkc`);
                const data = await response.json();
                
                if (data.values && data.values.length > 1) {
                    const headers = data.values[0];
                    const projects = data.values.slice(1)
                        .map(row => {
                            const project = {};
                            headers.forEach((header, index) => {
                                project[header] = row[index] || '';
                            });
                            return project;
                        });
                    
                    const project = projects.find(p => p.id === projectId);
                    if (project) {
                        displayProject(project);
                    } else {
                        // Clear content and show nothing
                        document.getElementById('detail-title').innerHTML = '';
                        document.getElementById('detail-description').textContent = '';
                        document.getElementById('detail-image').src = '';
                    }
                } else {
                    console.error('No data found in Google Sheets');
                    // Clear content and show nothing
                    document.getElementById('detail-title').innerHTML = '';
                    document.getElementById('detail-description').textContent = '';
                    document.getElementById('detail-image').src = '';
                }
            } catch (error) {
                console.error('Error loading project data:', error);
                // Clear content and show nothing
                document.getElementById('detail-title').innerHTML = '';
                document.getElementById('detail-description').textContent = '';
                document.getElementById('detail-image').src = '';
            }
        }
        
        function processTextWithLineBreaks(text) {
            if (!text) return '';
            // Convert \n to <br> tags and preserve existing HTML
            return text.replace(/\n/g, '<br>');
        }
        
        function displayProject(project) {
            const title = project[`title_${currentLang}`] || project.title_esp;
            const description = processTextWithLineBreaks(project[`description_${currentLang}`] || project.description_esp);
            const image = project.image_url || 'images/1.webp';
            const year = project.year || '';
            const subtitle = project.subtitle || '';
            
            // Create title with year and subtitle
            let fullTitle = `<span class="atb-title">${title}</span>`;
            if (subtitle || year) {
                let subtitlePart = subtitle || '';
                let yearPart = year || '';
                let separator = subtitlePart && yearPart ? ', ' : '';
                fullTitle += ` | ${subtitlePart}${separator}${yearPart}`;
            }
            
            document.getElementById('detail-title').innerHTML = fullTitle;
            document.getElementById('detail-description').innerHTML = description;
            document.getElementById('detail-image').src = image;
            document.getElementById('detail-image').alt = title;
        }

        // Initialize project data
        function initializeProject() {
            if (!projectId) {
                window.location.href = 'curaduria.html';
                return;
            }
            loadProjectData();
        }

        // Language switching
        function changeLanguage(lang) {
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('lang', lang);
            window.location.href = newUrl.toString();
        }

        // Update active language indicator
        function updateLanguageIndicator() {
            document.querySelectorAll('.language-switcher a').forEach(link => {
                link.classList.remove('active-lang');
                if (link.getAttribute('data-lang') === currentLang) {
                    link.classList.add('active-lang');
                }
            });
        }

        // Back button functionality
        function goBack() {
            // Check if we can go back in history
            if (window.history.length > 1) {
                window.history.back();
            } else {
                // Fallback to curaduria.html
                window.location.href = 'curaduria.html';
            }
        }

        // Handle browser back button
        window.addEventListener('popstate', function() {
            // If user navigates back, go to curaduria.html
            window.location.href = 'curaduria.html';
        });

        // Handle window resize to redirect to desktop version
        let resizeTimeout;
        let lastWidth = window.innerWidth;
        let isRedirecting = false;
        
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            
            const currentWidth = window.innerWidth;
            const wasMobile = lastWidth <= 767;
            const isNowDesktop = currentWidth > 767;
            
            // Only redirect if we're crossing the threshold from mobile to desktop
            if (wasMobile && isNowDesktop && !isRedirecting) {
                isRedirecting = true;
                // Immediate redirect to avoid intermediate states
                window.location.href = 'curaduria.html';
                return;
            }
            
            lastWidth = currentWidth;
            
            // Fallback timeout for edge cases
            resizeTimeout = setTimeout(function() {
                if (currentWidth > 767 && !isRedirecting) {
                    isRedirecting = true;
                    window.location.href = 'curaduria.html';
                }
            }, 100);
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeProject();
            updateLanguageIndicator();
            
            // Add history entry for this page
            if (window.history && window.history.pushState) {
                window.history.pushState({ page: 'curaduria-detail' }, '', window.location.href);
            }
        });
    </script>
</body>

</html> 